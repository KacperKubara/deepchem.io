<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>deepchem package &mdash; deepchem master documentation</title>

    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'master',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="deepchem master documentation" href="../index.html" />
    <link rel="next" title="deepchem.data package" href="../deepchem.data.html" />
    <link rel="prev" title="DeepChem" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="../_static/logo.png"></span>
          deepchem</a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">

                <li><a href="/docs/notebooks/index.html">Tutorials</a></li>


              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="/docs/deepchem.html">master</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="/docs/2.0.0/deepchem.html">2.0.0</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="/docs/1.3.1/deepchem.html">1.3.1</a></li>
</ul>
</ul>
</li>
</ul>
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

        </div>
    </div>
  </div><div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="creating-a-high-fidelity-deepchem-dataset-from-experimental-data">
<h1>Creating a high fidelity DeepChem dataset from experimental data<a class="headerlink" href="#creating-a-high-fidelity-deepchem-dataset-from-experimental-data" title="Permalink to this headline">¶</a></h1>
<p>Suppose you were given data collected by an experimental collaborator.
You would like to use this data to construct a DeepChem model.</p>
<p><em>How do you transform this data into a dataset capable of creating a
useful DeepChem model?</em></p>
<p>Building models from novel data can present several challenges. Perhaps
the data was not recorded in a convenient manner. Additionally, perhaps
the data contains noise. This is a common occurance with, for example,
biological assays due to the large number of external variables and the
difficulty and cost associated with collecting multiple samples. This is
a problem because you do not want your model to fit to this noise.</p>
<p>Hence, there are two primary challenges: * Parsing data * De-noising
data</p>
<p>In this tutorial, will walk through an example of curating a dataset
from an excel spreadsheet of experimental drug measurements.</p>
<div class="section" id="parsing-data">
<h2>Parsing data<a class="headerlink" href="#parsing-data" title="Permalink to this headline">¶</a></h2>
<p>In order to read in the data, we will use the pandas data analysis
library.</p>
<p>In order to convert the drug names into smiles strings, we will use
pubchempy.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pubchempy</span> <span class="kn">import</span> <span class="n">get_cids</span><span class="p">,</span> <span class="n">get_compounds</span>
</pre></div>
</div>
<p>Pandas is magic but it doesn’t automatically know where to find your
data of interest. You likely will have to look at it first using a GUI.</p>
<p>We will now look at a screenshot of this dataset as rendered by
LibreOffice.</p>
<p>To do this, we will import Image and os.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">data_screenshot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s1">&#39;assets/dataset_preparation_gui.png&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">data_screenshot</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/dataset_preparation_9_0.png" src="../_images/dataset_preparation_9_0.png" />
<p>We see the data of interest is on the second sheet, and contained in
columns “TA ID”, “N #1 (%)”, and “N #2 (%)”.</p>
<p>Additionally, it appears much of this spreadsheet was formatted for
human readability (multicolumn headers, column labels with spaces and
symbols, etc.). This makes the creation of a neat dataframe object
harder. For this reason we will cut everything that is unnecesary or
inconvenient.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">raw_data_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s1">&#39;../../datasets/Positive Modulators Summary_ 918.TUC _ v1.xlsx&#39;</span><span class="p">)</span>
<span class="n">raw_data_excel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">raw_data_file</span><span class="p">)</span>

<span class="c1"># second sheet only</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data_excel</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">raw_data_excel</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># preview 5 rows of raw dataframe</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">raw_data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>Metric #1 (-120 mV Peak)</th>
      <th>Unnamed: 1</th>
      <th>Unnamed: 2</th>
      <th>Unnamed: 3</th>
      <th>Unnamed: 4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NaN</th>
      <th>NaN</th>
      <th>NaN</th>
      <td>Vehicle</td>
      <td>NaN</td>
      <td>4</td>
      <td>Replications</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>TA ##</th>
      <th>Position</th>
      <th>TA ID</th>
      <td>Mean</td>
      <td>SD</td>
      <td>Threshold (%) = Mean + 4xSD</td>
      <td>N #1 (%)</td>
      <td>N #2 (%)</td>
    </tr>
    <tr>
      <th>1</th>
      <th>1-A02</th>
      <th>Penicillin V Potassium</th>
      <td>-12.8689</td>
      <td>6.74705</td>
      <td>14.1193</td>
      <td>-10.404</td>
      <td>-18.1929</td>
    </tr>
    <tr>
      <th>2</th>
      <th>1-A03</th>
      <th>Mycophenolate Mofetil</th>
      <td>-12.8689</td>
      <td>6.74705</td>
      <td>14.1193</td>
      <td>-12.4453</td>
      <td>-11.7175</td>
    </tr>
    <tr>
      <th>3</th>
      <th>1-A04</th>
      <th>Metaxalone</th>
      <td>-12.8689</td>
      <td>6.74705</td>
      <td>14.1193</td>
      <td>-8.65572</td>
      <td>-17.7753</td>
    </tr>
  </tbody>
</table>
</div><div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># remove column labels (rows 0 and 1), as we will replace them</span>
<span class="c1"># only take data given in columns &quot;N #1 (%)&quot; (3) and &quot;N #2 (%)&quot; (4)</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>

<span class="c1"># collapse multiindex so that drug names and number indexes are columns</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># rename columns</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># preview cleaner dataframe</span>
<span class="n">raw_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">raw_data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>drug</th>
      <th>n1</th>
      <th>n2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1-A02</td>
      <td>Penicillin V Potassium</td>
      <td>-10.404</td>
      <td>-18.1929</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1-A03</td>
      <td>Mycophenolate Mofetil</td>
      <td>-12.4453</td>
      <td>-11.7175</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1-A04</td>
      <td>Metaxalone</td>
      <td>-8.65572</td>
      <td>-17.7753</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1-A05</td>
      <td>Terazosin·HCl</td>
      <td>-11.5048</td>
      <td>16.0825</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1-A06</td>
      <td>Fluvastatin·Na</td>
      <td>-11.1354</td>
      <td>-14.553</td>
    </tr>
  </tbody>
</table>
</div><p>This formatting is closer to what we need.</p>
<p>Now, let’s take the drug names and get smiles strings for them (format
needed for DeepChem).</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">drugs</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<p>For many of these, we can retreive the smiles string via the
canonical_smiles attribute of the get_compounds object</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">get_compounds</span><span class="p">(</span><span class="n">drugs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Compound</span><span class="p">(</span><span class="mi">5281078</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">get_compounds</span><span class="p">(</span><span class="n">drugs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">canonical_smiles</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;CC1=C(C(=C(C2=C1COC2=O)O)CC=C(C)CCC(=O)OCCN3CCOCC3)OC&#39;</span>
</pre></div>
</div>
<p>However, some of these drug names have variables spaces and symbols (·,
(±), etc.), and names that may not be readable by pubchempy.</p>
<p>For this task, we will do a bit of hacking via regular expressions.
Also, we notice that all ions are written in a shortened form that will
need to be expanded. For this reason we use a dictionary, mapping the
shortened ion names to versions recognizable to pubchempy.</p>
<p>Unfortunately you may have several corner cases that will require more
hacking.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">ion_replacements</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;HBr&#39;</span><span class="p">:</span> <span class="s1">&#39; hydrobromide&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2Br&#39;</span><span class="p">:</span> <span class="s1">&#39; dibromide&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Br&#39;</span><span class="p">:</span> <span class="s1">&#39; bromide&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HCl&#39;</span><span class="p">:</span> <span class="s1">&#39; hydrochloride&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2H2O&#39;</span><span class="p">:</span> <span class="s1">&#39; dihydrate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;H20&#39;</span><span class="p">:</span> <span class="s1">&#39; hydrate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Na&#39;</span><span class="p">:</span> <span class="s1">&#39; sodium&#39;</span>
<span class="p">}</span>

<span class="n">ion_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H20&#39;</span><span class="p">,</span> <span class="s1">&#39;HBr&#39;</span><span class="p">,</span> <span class="s1">&#39;HCl&#39;</span><span class="p">,</span> <span class="s1">&#39;2Br&#39;</span><span class="p">,</span> <span class="s1">&#39;2H2O&#39;</span><span class="p">,</span> <span class="s1">&#39;Br&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compound_to_smiles</span><span class="p">(</span><span class="n">cmpd</span><span class="p">):</span>
    <span class="c1"># remove spaces and irregular characters</span>
    <span class="n">compound</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^\s\w]|_)+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cmpd</span><span class="p">)</span>

    <span class="c1"># replace ion names if needed</span>
    <span class="k">for</span> <span class="n">ion</span> <span class="ow">in</span> <span class="n">ion_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ion</span> <span class="ow">in</span> <span class="n">compound</span><span class="p">:</span>
            <span class="n">compound</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ion</span><span class="p">,</span> <span class="n">ion_replacements</span><span class="p">[</span><span class="n">ion</span><span class="p">])</span>

    <span class="c1"># query for cid first in order to avoid timeouterror</span>
    <span class="n">cid</span> <span class="o">=</span> <span class="n">get_cids</span><span class="p">(</span><span class="n">compound</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">smiles</span> <span class="o">=</span> <span class="n">get_compounds</span><span class="p">(</span><span class="n">cid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">canonical_smiles</span>

    <span class="k">return</span> <span class="n">smiles</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">smiles_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">drugs</span><span class="p">:</span>
    <span class="n">smiles_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">compound_to_smiles</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">smiles_data</span> <span class="o">=</span> <span class="n">raw_data</span>
<span class="c1"># map drug name to smiles string</span>
<span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">smiles_map</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># preview smiles data</span>
<span class="n">smiles_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">smiles_data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>drug</th>
      <th>n1</th>
      <th>n2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1-A02</td>
      <td>CC1(C(N2C(S1)C(C2=O)NC(=O)COC3=CC=CC=C3)C(=O)[...</td>
      <td>-10.404</td>
      <td>-18.1929</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1-A03</td>
      <td>CC1=C(C(=C(C2=C1COC2=O)O)CC=C(C)CCC(=O)OCCN3CC...</td>
      <td>-12.4453</td>
      <td>-11.7175</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1-A04</td>
      <td>CC1=CC(=CC(=C1)OCC2CNC(=O)O2)C</td>
      <td>-8.65572</td>
      <td>-17.7753</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1-A05</td>
      <td>COC1=C(C=C2C(=C1)C(=NC(=N2)N3CCN(CC3)C(=O)C4CC...</td>
      <td>-11.5048</td>
      <td>16.0825</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1-A06</td>
      <td>CC(C)N1C2=CC=CC=C2C(=C1C=CC(CC(CC(=O)[O-])O)O)...</td>
      <td>-11.1354</td>
      <td>-14.553</td>
    </tr>
  </tbody>
</table>
</div><p>Hooray, we have mapped each drug name to its corresponding smiles code.</p>
<p>Now, we need to look at the data and remove as much noise as possible.</p>
</div>
<div class="section" id="de-noising-data">
<h2>De-noising data<a class="headerlink" href="#de-noising-data" title="Permalink to this headline">¶</a></h2>
<p>In machine learning, we know that there is no free lunch. You will need
to spend time analyzing and understanding your data in order to frame
your problem and determine the appropriate model framework. Treatment of
your data will depend on the conclusions you gather from this process.</p>
<p>Questions to ask yourself: * What are you trying to accomplish? * What
is your assay? * What is the structure of the data? * Does the data
make sense? * What has been tried previously?</p>
<p>For this project (respectively): * I would like to build a model
capable of predicting the affinity of an arbitrary small molecule drug
to a particular ion channel protein * For an input drug, data
describing channel inhibition * A few hundred drugs, with n=2 * Will
need to look more closely at the dataset* * Nothing on this particular
protein</p>
<p>*This will involve plotting, so we will import matplotlib and seaborn.
We will also need to look at molecular structures, so we will import
rdkit.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
%matplotlib inline

import seaborn as sns
sns.set_style(&#39;white&#39;)
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">AllChem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">Draw</span><span class="p">,</span> <span class="n">PyMol</span><span class="p">,</span> <span class="n">rdFMCS</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem.Draw</span> <span class="kn">import</span> <span class="n">IPythonConsole</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">rdBase</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># i will use numpy on occasion for manipulating arrays</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>Our goal is to build a small molecule model, so let’s make sure our
molecules are all small. This can be approximated by the length of each
smiles string.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">smiles_lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">smiles_lens</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;len(smiles)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x7f7c64a92450&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_36_1.png" src="../_images/dataset_preparation_36_1.png" />
<p>Some of these look rather large, len(smiles) &gt; 150. Let’s see what they
look like.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># indices of large looking molecules</span>
<span class="n">suspiciously_large</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smiles_lens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># corresponding smiles string</span>
<span class="n">long_smiles</span> <span class="o">=</span> <span class="n">smiles_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">smiles_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">suspiciously_large</span><span class="p">]][</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># look</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">_MolsToGridImage</span><span class="p">([</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">long_smiles</span><span class="p">],</span> <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/dataset_preparation_39_0.png" src="../_images/dataset_preparation_39_0.png" />
<p>As suspected, these are not small molecules, so we will remove them from
the dataset. The argument here is that these molecules could register as
inhibitors simply because they are large. They are more likely to
sterically blocks the channel, rather than diffuse inside and bind
(which is what we are interested in).</p>
<p>The lesson here is to remove data that does not fit your use case.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># drop large molecules</span>
<span class="n">smiles_data</span> <span class="o">=</span> <span class="n">smiles_data</span><span class="p">[</span><span class="o">~</span><span class="n">smiles_data</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">long_smiles</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now, let’s look at the numerical structure of the dataset.</p>
<p>First, check for NaNs.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">nan_rows</span> <span class="o">=</span> <span class="n">smiles_data</span><span class="p">[</span><span class="n">smiles_data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
<span class="n">nan_rows</span><span class="p">[[</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n1</th>
      <th>n2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>NaN</td>
      <td>-7.8266</td>
    </tr>
    <tr>
      <th>176</th>
      <td>NaN</td>
      <td>-6.61225</td>
    </tr>
    <tr>
      <th>188</th>
      <td>NaN</td>
      <td>-8.23326</td>
    </tr>
    <tr>
      <th>234</th>
      <td>-8.21781</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>263</th>
      <td>NaN</td>
      <td>-12.8788</td>
    </tr>
    <tr>
      <th>289</th>
      <td>NaN</td>
      <td>-2.34264</td>
    </tr>
    <tr>
      <th>301</th>
      <td>NaN</td>
      <td>-8.19936</td>
    </tr>
    <tr>
      <th>302</th>
      <td>NaN</td>
      <td>-10.4633</td>
    </tr>
    <tr>
      <th>312</th>
      <td>NaN</td>
      <td>-8.78722</td>
    </tr>
    <tr>
      <th>396</th>
      <td>-5.32572</td>
      <td>-1.7599</td>
    </tr>
    <tr>
      <th>400</th>
      <td>-1.45559</td>
      <td>-6.47666</td>
    </tr>
  </tbody>
</table>
</div><p>I don’t trust n=1, so I will throw these out.</p>
<p>Then, let’s examine the distribution of n1 and n2.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">smiles_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># seaborn jointplot will allow us to compare n1 and n2, and plot each marginal</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">smiles_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x7f7c6187c3d0&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_46_1.png" src="../_images/dataset_preparation_46_1.png" />
<p>We see that most of the data is contained in the gaussian-ish blob
centered a bit below zero. We see that there are a few clearly active
datapoints located in the bottom left, and one on the top right. These
are all distinguished from the majority of the data. How do we handle
the data in the blob?</p>
<p>Because n1 and n2 represent the same measurement, ideally they would be
of the same value. This plot should be tightly aligned to the diagonal,
and the pearson correlation coefficient should be 1. We see this is not
the case. This helps gives us an idea of the error of our assay.</p>
<p>Let’s look at the error more closely, plotting in the distribution of
(n1-n2).</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">diff_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">diff_df</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;difference in n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x7f7c5b951150&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_48_1.png" src="../_images/dataset_preparation_48_1.png" />
<p>This looks pretty gaussian, let’s get the 95% confidence interval by
fitting a gaussian via scipy, and taking 2*the standard deviation</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">diff_df</span><span class="p">)</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">ci_95</span> <span class="o">=</span> <span class="n">std</span><span class="o">*</span><span class="mi">2</span>
<span class="n">ci_95</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="mf">17.803505462981775</span>
</pre></div>
</div>
<p>Now, I don’t trust the data outside of the confidence interval, and will
therefore drop these datapoints from df.</p>
<p>For example, in the plot above, at least one datapoint has n1-n2 &gt; 60.
This is disconcerting.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">noisy</span> <span class="o">=</span> <span class="n">diff_df</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ci_95</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">noisy</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x7f7c5b7bbb10&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_55_1.png" src="../_images/dataset_preparation_55_1.png" />
<p>Now that data looks much better!</p>
<p>So, let’s average n1 and n2, and take the error bar to be ci_95.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">avg_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;drug&#39;</span><span class="p">]]</span>
<span class="n">n_avg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;n2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">avg_df</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_avg</span>
<span class="n">avg_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>/home/kmckiern/miniconda2/lib/python2.7/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  This is separate from the ipykernel package so we can avoid doing imports until
/home/kmckiern/miniconda2/lib/python2.7/site-packages/ipykernel_launcher.py:4: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  after removing the cwd from sys.path.
</pre></div>
</div>
<p>Now, let’s look at the sorted data with error bars.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">avg_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">avg_df</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ci_95</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;drug, sorted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x7f7c5b3aa590&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_59_1.png" src="../_images/dataset_preparation_59_1.png" />
<p>Now, let’s identify our active compounds.</p>
<p>In my case, this required domain knowledge. Having worked in this area,
and having consulted with professors specializing on this channel, I am
interested in compounds where the absolute value of the activity is
greater than 25. This relates to the desired drug potency we would like
to model.</p>
<p>If you are not certain how to draw the line between active and inactive,
this cutoff could potentially be treated as a hyperparameter.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">actives</span> <span class="o">=</span> <span class="n">avg_df</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">avg_df</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">ci_95</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">][</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">actives</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">actives</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ci_95</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;Container object of 3 artists&gt;
</pre></div>
</div>
<img alt="../_images/dataset_preparation_61_1.png" src="../_images/dataset_preparation_61_1.png" />
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># summary</span>
<span class="k">print</span> <span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">avg_df</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">actives</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">430</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">392</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>In summary, we have: * Removed data that did not address the question
we hope to answer (small molecules only) * Dropped NaNs * Determined
the noise of our measurements * Removed exceptionally noisy datapoints
* Identified actives (using domain knowledge to determine a threshold)</p>
</div>
<div class="section" id="determine-model-type-final-form-of-dataset-and-sanity-load">
<h2>Determine model type, final form of dataset, and sanity load<a class="headerlink" href="#determine-model-type-final-form-of-dataset-and-sanity-load" title="Permalink to this headline">¶</a></h2>
<p>Now, what model framework should we use?</p>
<p>Given that we have 392 datapoints and 6 actives, this data will be used
to build a low data one-shot classifier (10.1021/acscentsci.6b00367). If
there were datasets of similar character, transfer learning could
potentially be used, but this is not the case at the moment.</p>
<p>Let’s apply logic to our dataframe in order to cast it into a binary
format, suitable for classification.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 1 if condition for active is met, 0 otherwise</span>
<span class="n">avg_df</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">avg_df</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">ci_95</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>/home/kmckiern/miniconda2/lib/python2.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
</pre></div>
</div>
<p>Now, save this to file.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">avg_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;modulators.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we will convert this dataframe to a DeepChem dataset.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">deepchem</span> <span class="kn">as</span> <span class="nn">dc</span>
</pre></div>
</div>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">dataset_file</span> <span class="o">=</span> <span class="s1">&#39;modulators.csv&#39;</span>
<span class="n">task</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]</span>
<span class="n">featurizer_func</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">feat</span><span class="o">.</span><span class="n">ConvMolFeaturizer</span><span class="p">()</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">CSVLoader</span><span class="p">(</span><span class="n">tasks</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">smiles_field</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="n">featurizer</span><span class="o">=</span><span class="n">featurizer_func</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">featurize</span><span class="p">(</span><span class="n">dataset_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Loading raw samples now.
shard_size: 8192
About to start loading CSV from modulators.csv
Loading shard 1 of size 8192.
Featurizing sample 0
TIMING: featurizing shard 0 took 0.897 s
TIMING: dataset construction took 1.621 s
Loading dataset from disk.
</pre></div>
</div>
<p>Lastly, it is often advantageous to numerically transform the data in
some way. For example, sometimes it is useful to normalize the data, or
to zero the mean. This depends in the task at hand.</p>
<p>Built into DeepChem are many useful transformers, located in the
deepchem.transformers.transformers base class.</p>
<p>Because this is a classification model, and the number of actives is
low, I will apply a balancing transformer. I treated this transformer as
a hyperparameter when I began training models. It proved to
unambiguously improve model performance.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">transformer</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">BalancingTransformer</span><span class="p">(</span><span class="n">transform_w</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>TIMING: dataset construction took 1.066 s
Loading dataset from disk.
</pre></div>
</div>
<p>Now let’s save the balanced dataset object to disk, and then reload it
as a sanity check.</p>
<div class="code ipython2 highlight-python"><div class="highlight"><pre><span></span><span class="n">dc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save</span><span class="o">.</span><span class="n">save_to_disk</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">&#39;balanced_dataset.joblib&#39;</span><span class="p">)</span>
<span class="n">balanced_dataset</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save</span><span class="o">.</span><span class="n">load_from_disk</span><span class="p">(</span><span class="s1">&#39;balanced_dataset.joblib&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Tutorial written by Keri McKiernan (github.com/kmckiern) on September 8,
2016</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/notebooks/dataset_preparation.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2016, Stanford University and the Authors.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>